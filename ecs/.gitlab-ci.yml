variables:
  # # NOT RECOMMENDED: if you want to deploy in dev from MR pipelines
  # ENABLE_NOT_RECOMMENDED_MR_DEV_DEPLOY: 'true'

  # # If you want to run destroy pipeline
  # PIPELINE_ACTION: destroy

  # # ***WARNING***: You have to get exemption from CloudSec (Slack channel: #team-cloudsecurity)
  # # to suppress any vulnerabilities.
  # #
  # # Showing how you can suppress a rule. Checkov will still show you the errors but will exit with 0
  # # As a result pipeline will show green.
  # #
  # # Default is `--quiet --support --repo-root-for-plan-enrichment terraform --soft-fail-on MEDIUM`.
  # #
  # # Use this only when you have exemptions from CloudSec for checks that cannot be resolved.
  # #
  # # Use this option if you want to override default options for all namespaces.
  # # If you want to set these options for a single namespace then set as variables in `environments.yml` file.
  # # This will be overridden by options set per namespace in `environments.yml` file.
  # #
  # # Check https://www.checkov.io/2.Basics/CLI%20Command%20Reference.html for checkov options
  # OPTS_CHECKOV_IAC_SCAN: --quiet --support --repo-root-for-plan-enrichment terraform --soft-fail-on LOW,CKV_AWS_26,CKV_AWS_169
  #
  # Forcing all namespaces to fail on MEDIUM and above vulnerabilities
  OPTS_CHECKOV_IAC_SCAN: --quiet --support --repo-root-for-plan-enrichment terraform --soft-fail-on LOW

  # # Similar to `OPTS_CHECKOV_IAC_SCAN` you can use `OPTS_CHECKOV_IAC_STATIC_SCAN` to override the IAC stattic scan job.
  # # Same warnings and details apply as above for `OPTS_CHECKOV_IAC_SCAN`.
  # #
  # # NOTE that this for the static checkov scan which is not namespaced and will have no effects if you add them to `environments.yml`
  # # which genrates jobs for each namespaces.
  # #
  # # Default is `--quiet --support --download-external-modules true --soft-fail-on MEDIUM`.
  # OPTS_CHECKOV_IAC_STATIC_SCAN: --quiet --support --download-external-modules true --soft-fail-on LOW

  # Soft failing on (false-positvies)
  #
  # CKV_AWS_91: "AWS Elastic Load Balancer v2 (ELBv2) with access log disabled"
  # CKV_AWS_103: "AWS Load Balancer is not using TLS 1.2"
  # CKV_AWS_97: "EFS volumes in ECS task definitions do not have encryption in transit enabled"
  # 806079905565028352_AWS_1742227587794: "DDARKE - AWS Application Load Balancer (ALB) listener that allow connection requests over HTTP"
  #
  # Explanation:
  # As they are coming from public module defaults but when deploying these are all configured properly.
  # Check dynamic scan job results.
  #
  OPTS_CHECKOV_IAC_STATIC_SCAN: --quiet --support --download-external-modules true --soft-fail-on MEDIUM,CKV_AWS_91,CKV_AWS_97,CKV_AWS_103,806079905565028352_AWS_1742227587794

  # # Use this if you are NOT setting a region per namespace in `environments.yml`.
  # # This variable has the **highest precedence** and will override any region settings in `environments.yml`
  # # when the a pipeline is trigerred manually.
  # REGION:
  #   value: us-east-1
  #   options:
  #     - us-east-1
  #     - us-west-2
  #     - eu-central-1
  #     - eu-west-1
  #   description: Select a region to apply infrastructure changes to

  # Use this if you ARE setting regions per namespace in `environments.yml`.
  # This variable **will be overridden** by the `REGION` value set in `environments.yml`.
  AWS_REGION:
    value: us-east-1
    options:
      - us-east-1
      - us-west-2
      - eu-central-1
      - eu-west-1
    description: Select a region to apply infrastructure changes to

include:
  - project: DDARKE-common/devplat/ccp-next/ccp-next-pipeline-fragments
    ref: 1.28.0
    file: pipelines/deploy-infra.gitlab-ci.yml
  - local: .gitlab-deployments-ci.yml
